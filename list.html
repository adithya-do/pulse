{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>Oracle Databases</h4>
  <a href="/oracle/target/new" class="btn btn-sm btn-success">+ Add Database</a>
</div>
<table class="table table-bordered table-sm align-middle">
  <thead><tr>
    <th>S.NO</th><th>DB Name</th><th>Env</th><th>Host</th><th>DB Version</th><th>Status</th><th>Inst Status</th><th>Open Mode</th>
    <th>Worst TS %</th><th>TS Online</th><th>Last Full Bkp</th><th>Last Arch Bkp</th><th>Last Check</th><th>Check Status</th><th>Error</th><th>Actions</th>
  </tr></thead>
  <tbody>
  {% for t in targets %}
    <tr>
      <td>{{t.S_NO}}</td>
      <td>{{t.DB_NAME}}</td>
      <td>{{t.ENVIRONMENT}}</td>
      <td>{{t.HOST}}</td>
      <td>{{t.DB_VERSION}}</td>
      <td>{{t.STATUS}}</td>
      <td>{{t.INSTANCE_STATUS or '-'}}</td>
      <td>{{t.DB_OPEN_MODE or '-'}}</td>
      <td>{{t.WORST_TBS_PCT or '-'}}</td>
      <td>{{'Yes' if t.TABLESPACES_ONLINE==1 else 'No' if t.TABLESPACES_ONLINE==0 else '-'}}</td>
      <td>{{t.LAST_FULL_BACKUP or '-'}}</td>
      <td>{{t.LAST_ARCH_BACKUP or '-'}}</td>
      <td>{{t.LAST_CHECK or '-'}}</td>
      <td>{{t.CHECK_STATUS or '-'}}</td>
      <td class="text-danger" style="max-width:200px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">{{t.ERROR_MSG or ''}}</td>
      <td>
        <form method="post" action="/oracle/target/{{t.TARGET_ID}}/check" style="display:inline"><button class="btn btn-sm btn-outline-primary">Run Check</button></form>
        <a class="btn btn-sm btn-outline-secondary" href="/oracle/target/{{t.TARGET_ID}}/edit">Edit</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
